<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta
      name="description"
      content="Sitemax — automatic sitemap generation & SEO helpers for static sites"
    />
    <title>Sitemax — Sitemap Generator</title>
    <link rel="stylesheet" crossorigin href="/sitemax/assets/main-DlAIcBzX.css">
  </head>
  <body>
    <header>
      <div class="container header-row">
        <div class="logo">Sitemax</div>
        <nav>
          <a href="./">Home</a>
          <a href="./docs">Docs</a>
          <a href="./services">Services</a>
          <a href="./blog">Blog</a>
          <a href="./contact">Contact</a>
        </nav>
      </div>
    </header>

    <main class="container hero">
      <div class="hero-left">
        <h1>Sitemax</h1>
        <p class="tagline">
          Automatic sitemap & robots generator for Vite-powered static sites —
          built for fast deploys and SEO checks.
        </p>

        <div class="cta-row">
          <a class="btn-primary" href="./about#installation">Install</a>
          <a
            class="btn-ghost"
            href="https://github.com/ArtechFuz3D/sitemax"
            target="_blank"
            rel="noopener"
            >View on GitHub</a
          >
        </div>

        <ul class="features">
          <li>Generates sitemap.xml & robots.txt on build</li>
          <li>Works with GitHub Pages & Vite base paths</li>
          <li>Small plugin, easy to configure</li>
        </ul>
      </div>

      <aside class="hero-right">
        <h3>Live test logs</h3>
        <div id="logs" class="log-panel" aria-live="polite"></div>
        <div class="log-controls">
          <button id="run-tests" class="btn-sm">Run tests</button>
          <button id="clear-logs" class="btn-sm ghost">Clear</button>
        </div>
      </aside>
    </main>

    <footer>
      <div class="container">
        <p>&copy; 2025 Sitemax. All rights reserved.</p>
      </div>
    </footer>

    <script>
      // Simple animated log runner for the landing page (non-blocking, UI-only)
      const LOGS = [
        { text: "Checking plugin status...", delay: 600, type: "info" },
        { text: "Looking for sitemap.xml", delay: 800, type: "info" },
        {
          text: "Trying https://artechfuz3d.github.io/sitemax/sitemap.xml",
          delay: 900,
          type: "try",
        },
        { text: "sitemap.xml found", delay: 500, type: "ok" },
        { text: "Looking for robots.txt", delay: 600, type: "info" },
        {
          text: "Trying https://artechfuz3d.github.io/sitemax/robots.txt",
          delay: 800,
          type: "try",
        },
        { text: "robots.txt found", delay: 400, type: "ok" },
        { text: "All checks passed ✅", delay: 700, type: "success" },
      ];

      function appendLogLine(text, type = "info") {
        const out = document.getElementById("logs");
        const line = document.createElement("div");
        line.className = "log-line " + type;
        // small typing effect
        let i = 0;
        const span = document.createElement("span");
        line.appendChild(span);
        out.appendChild(line);
        out.scrollTop = out.scrollHeight;
        const t = setInterval(() => {
          span.textContent += text.charAt(i++);
          out.scrollTop = out.scrollHeight;
          if (i > text.length) clearInterval(t);
        }, 10);
      }

      function runDemoLogs() {
        const btn = document.getElementById("run-tests");
        btn.disabled = true;
        let t = 0;
        LOGS.forEach((entry, idx) => {
          t += entry.delay;
          setTimeout(() => {
            appendLogLine(entry.text, entry.type);
            if (idx === LOGS.length - 1) btn.disabled = false;
          }, t);
        });
      }

      document
        .getElementById("run-tests")
        .addEventListener("click", runDemoLogs);
      document.getElementById("clear-logs").addEventListener("click", () => {
        document.getElementById("logs").innerHTML = "";
      });

      // Auto-run once for landing page
      setTimeout(runDemoLogs, 600);
    </script>
    <script>
      // Quick check for basic meta presence
      function testSEOPlugin() {
        const metaDescription = document.querySelector(
          'meta[name="description"]'
        );
        const ogTitle = document.querySelector('meta[property="og:title"]');
        return !!(metaDescription && ogTitle);
      }

      // Resolve a candidate URL against document.baseURI (works for file://, http(s) and GH Pages base)
      function resolveAgainstBase(href) {
        try {
          return new URL(href, document.baseURI).href;
        } catch {
          return href;
        }
      }

      // Build a list of candidate sitemap/robots URLs to try
      function buildCandidates(filename) {
        const candidates = new Set();

        // 1) relative to current document base
        candidates.add(resolveAgainstBase(filename));
        // 2) absolute at origin root
        try {
          candidates.add(
            new URL("/" + filename.replace(/^\/+/, ""), location.origin).href
          );
        } catch {}
        // 3) try prefixed with the first pathname segment (handles GH Pages subpath /sitemax/)
        try {
          const parts = location.pathname.split("/").filter(Boolean);
          if (parts.length > 0) {
            candidates.add(
              new URL(`/${parts[0]}/${filename}`, location.origin).href
            );
          }
        } catch {}
        // 4) try canonical / og:url if available
        const canonical = document
          .querySelector('link[rel="canonical"]')
          ?.getAttribute("href");
        const ogUrl = document
          .querySelector('meta[property="og:url"]')
          ?.getAttribute("content");
        for (const src of [canonical, ogUrl]) {
          if (src) {
            try {
              const base =
                new URL(src).origin +
                new URL(src).pathname.replace(/\/[^/]*$/, "/");
              candidates.add(new URL(filename, base).href);
            } catch {}
          }
        }
        // return ordered array (prefer document.baseURI first)
        return Array.from(candidates);
      }

      // Try fetching candidate URLs sequentially with small timeout and return first ok
      async function findExistingFile(filename, timeout = 3000) {
        const candidates = buildCandidates(filename);
        for (const url of candidates) {
          try {
            // use GET (some servers don't support HEAD reliably)
            const controller = new AbortController();
            const id = setTimeout(() => controller.abort(), timeout);
            const res = await fetch(url, {
              method: "GET",
              cache: "no-store",
              signal: controller.signal,
            });
            clearTimeout(id);
            if (res && res.ok) return { found: true, url };
          } catch (e) {
            // ignore and try next candidate
          }
        }
        return { found: false, tried: candidates };
      }

      async function runPluginTests() {
        const seoOk = testSEOPlugin();
        const sitemapCheck = await findExistingFile("sitemap.xml");
        const robotsCheck = await findExistingFile("robots.txt");

        const resultEl = document.getElementById("plugin-test");

        if (seoOk && sitemapCheck.found && robotsCheck.found) {
          resultEl.innerHTML =
            '<strong style="color:green;">✅ Plugin is working! SEO meta tags, sitemap.xml, and robots.txt detected.</strong>' +
            `<div style="font-size:0.9em;margin-top:6px;">sitemap: ${sitemapCheck.url} — robots: ${robotsCheck.url}</div>`;
        } else {
          const errors = [];
          if (!seoOk) errors.push("SEO meta tags missing");
          if (!sitemapCheck.found) errors.push("sitemap.xml missing");
          if (!robotsCheck.found) errors.push("robots.txt missing");
          resultEl.innerHTML =
            '<strong style="color:red;">❌ Plugin test failed: ' +
            errors.join(", ") +
            "</strong>" +
            `<div style="font-size:0.8em;margin-top:6px;color:#666;">Tried: ${(
              sitemapCheck.tried || []
            )
              .concat(robotsCheck.tried || [])
              .join(" , ")}</div>`;
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        runPluginTests();
      });
    </script>
  </body>
</html>
