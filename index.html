<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Welcome to Sitemax - Your automated sitemap generation solution"
    />
    <meta property="og:title" content="Sitemax - Automated Sitemap Generator" />
    <meta
      property="og:description"
      content="Welcome to Sitemax - Your automated sitemap generation solution"
    />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/public/og-image.png" />
    <meta name="theme-color" content="#2563eb" />
    <title>Sitemax - Automated Sitemap Generator</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" crossorigin href="/sitemax/assets/main-DlAIcBzX.css">
  </head>
  <body>
    <header>
      <div class="container">
        <div class="logo">Sitemax</div>
        <nav>
          <a href="./">Home</a>
          <a href="./about">About</a>
          <a href="./services">Services</a>
          <a href="./blog">Blog</a>
          <a href="./contact">Contact</a>
        </nav>
      </div>
    </header>

    <main class="container">
      <h1>Welcome to Sitemax</h1>
      <p>
        Your automated solution for sitemap generation and SEO optimization.
      </p>

      <h2>Plugin Status</h2>
      <div id="plugin-test">Checking plugin status...</div>
    </main>

    <footer>
      <div class="container">
        <p>&copy; 2025 Sitemax. All rights reserved.</p>
      </div>
    </footer>

    <script>
      // Quick check for basic meta presence
      function testSEOPlugin() {
        const metaDescription = document.querySelector('meta[name="description"]');
        const ogTitle = document.querySelector('meta[property="og:title"]');
        return !!(metaDescription && ogTitle);
      }

      // Resolve a candidate URL against document.baseURI (works for file://, http(s) and GH Pages base)
      function resolveAgainstBase(href) {
        try {
          return new URL(href, document.baseURI).href;
        } catch {
          return href;
        }
      }

      // Build a list of candidate sitemap/robots URLs to try
      function buildCandidates(filename) {
        const candidates = new Set();

        // 1) relative to current document base
        candidates.add(resolveAgainstBase(filename));
        // 2) absolute at origin root
        try {
          candidates.add(new URL('/' + filename.replace(/^\/+/, ''), location.origin).href);
        } catch {}
        // 3) try prefixed with the first pathname segment (handles GH Pages subpath /sitemax/)
        try {
          const parts = location.pathname.split('/').filter(Boolean);
          if (parts.length > 0) {
            candidates.add(new URL(`/${parts[0]}/${filename}`, location.origin).href);
          }
        } catch {}
        // 4) try canonical / og:url if available
        const canonical = document.querySelector('link[rel="canonical"]')?.getAttribute('href');
        const ogUrl = document.querySelector('meta[property="og:url"]')?.getAttribute('content');
        for (const src of [canonical, ogUrl]) {
          if (src) {
            try {
              const base = new URL(src).origin + new URL(src).pathname.replace(/\/[^/]*$/, '/');
              candidates.add(new URL(filename, base).href);
            } catch {}
          }
        }
        // return ordered array (prefer document.baseURI first)
        return Array.from(candidates);
      }

      // Try fetching candidate URLs sequentially with small timeout and return first ok
      async function findExistingFile(filename, timeout = 3000) {
        const candidates = buildCandidates(filename);
        for (const url of candidates) {
          try {
            // use GET (some servers don't support HEAD reliably)
            const controller = new AbortController();
            const id = setTimeout(() => controller.abort(), timeout);
            const res = await fetch(url, { method: 'GET', cache: 'no-store', signal: controller.signal });
            clearTimeout(id);
            if (res && res.ok) return { found: true, url };
          } catch (e) {
            // ignore and try next candidate
          }
        }
        return { found: false, tried: candidates };
      }

      async function runPluginTests() {
        const seoOk = testSEOPlugin();
        const sitemapCheck = await findExistingFile('sitemap.xml');
        const robotsCheck = await findExistingFile('robots.txt');

        const resultEl = document.getElementById('plugin-test');

        if (seoOk && sitemapCheck.found && robotsCheck.found) {
          resultEl.innerHTML =
            '<strong style="color:green;">✅ Plugin is working! SEO meta tags, sitemap.xml, and robots.txt detected.</strong>' +
            `<div style="font-size:0.9em;margin-top:6px;">sitemap: ${sitemapCheck.url} — robots: ${robotsCheck.url}</div>`;
        } else {
          const errors = [];
          if (!seoOk) errors.push('SEO meta tags missing');
          if (!sitemapCheck.found) errors.push('sitemap.xml missing');
          if (!robotsCheck.found) errors.push('robots.txt missing');
          resultEl.innerHTML =
            '<strong style="color:red;">❌ Plugin test failed: ' + errors.join(', ') + '</strong>' +
            `<div style="font-size:0.8em;margin-top:6px;color:#666;">Tried: ${ (sitemapCheck.tried || []).concat(robotsCheck.tried || []).join(' , ') }</div>`;
        }
      }

      document.addEventListener('DOMContentLoaded', () => {
        runPluginTests();
      });
    </script>
  </body>
</html>
